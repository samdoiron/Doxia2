#!/usr/bin/env ruby -Itest

require_relative '../lib/in_memory'
require 'minitest'
require 'minitest/hell'
require 'minitest/spec'

def gem_root
  Pathname(File.expand_path(File.dirname(__FILE__))).parent
end

def run_all_tests
  Dir.glob(gem_root.to_s + '/test/*_test.rb').each do |file|
    require gem_root.join(file)
  end
  Minitest.autorun
end

def run_test_with_approximate_name(fuzzy)
  Dir.glob("#{gem_root}/test/*#{fuzzy}*_test.rb").each do |file|
    puts "Running test #{file}"
    require gem_root.join(file)
  end
  Minitest.autorun
end

if ARGV.empty?
  run_all_tests
else
  run_test_with_approximate_name(ARGV.first)
end
